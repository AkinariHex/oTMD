<!DOCTYPE html>
<html class="settings" lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>OTMD Dashboard</title>
		<link rel="stylesheet" type="text/css" href="/assets/semantic.min.css">
		<script
		src="https://code.jquery.com/jquery-3.1.1.min.js"
		integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
		crossorigin="anonymous"></script>
		<script src="/assets/semantic.min.js"></script>
		<link rel="stylesheet" href="/assets/style.css" />
	</head>
	<body>
		<div class="header">
			<div class="ui top attached tabular menu">
				<a class="item active" data-tab="match">Match</a>
				<a class="item" data-tab="settings">Settings</a>
			  </div>
			<div class="ui equal width form">
			  <div class="ui bottom attached tab segment active" data-tab="match">

				<div id="updatemessage" name="updatemessage" class="updatemessage">
					<div class="ui warning message">
						<div class="header">Old Version</div>
						<p>You're using an older version of the displayer, please be sure to update to the latest version to avoid bugs and malfunctions!
							You can update to the latest by:</p>
						<ul class="list">
						  <li>Closing the displayer and run <b>update.exe</b></li>
						  <li>Download the latest version <a href="https://github.com/AkinariHex/oTMD/releases/latest">here</a></li>
						</ul>
					</div>
				</div>
					
					<div class="fields">
					  <div class="required field">
						<label>APIkey</label>
						<input type="text" name="apikey" id="apikey" placeholder="APIkey"/>
					  </div>
					  <div class="field">
						<label>UserID</label>
						<input type="text" name="userid" id="userid" placeholder="UserID"/>
					  </div>
					</div>
					<h4 class="ui dividing header"></h4>
					<div class="fields">
					  <div class="required field">
						<label>MatchID</label>
						<input type="text" name="matchid" id="matchid" placeholder="MatchID" />
					  </div>
					  <div class="required field">
						<label>Match Type</label>
						<div class="ui selection dropdown">
							<input type="hidden" name="matchtype">
							<i class="dropdown icon"></i>
							<div class="default text">Match Type</div>
							<div class="menu">
							  <div class="item" data-value="h1v1" data-text="1vs1">
								1vs1
							  </div>
							  <div class="item" data-value="teamvs" data-text="TeamVS">
								TeamVS
							  </div>
							</div>
						  </div>
					  </div>
					</div>
					<div class="fields">
						<div class="required field">
							<label>Stage</label>
							<div class="ui selection dropdown">
								<input type="hidden" name="stage">
								<i class="dropdown icon"></i>
								<div class="default text">Stage</div>
								<div class="menu">
								  <div class="item" data-value="Friendly" data-text="Friendly">
									Friendly
								  </div>
								  <div class="item" data-value="Round of 64" data-text="RO64">
									RO64
								  </div>
								  <div class="item" data-value="Round of 32" data-text="RO32">
									RO32
								  </div>
								  <div class="item" data-value="Round of 16" data-text="RO16">
									RO16
								  </div>
								  <div class="item" data-value="Quarterfinals" data-text="Quarterfinals">
									Quarterfinals
								  </div>
								  <div class="item" data-value="Semifinals" data-text="Semifinals">
									Semifinals
								  </div>
								  <div class="item" data-value="Finals" data-text="Finals">
									Finals
								  </div>
								  <div class="item" data-value="Grand Finals" data-text="Grand Finals">
									Grand Finals
								  </div>
								</div>
							  </div>
						  </div>
						  <div class="required field">
							<label>Best of</label>
							<div class="ui selection dropdown">
								<input type="hidden" name="bestof">
								<i class="dropdown icon"></i>
								<div class="default text">Best of</div>
								<div class="menu">
								  <div class="item" data-value="5" data-text="BO5">
									BO5
								  </div>
								  <div class="item" data-value="7" data-text="BO7">
									BO7
								  </div>
								  <div class="item" data-value="9" data-text="BO9">
									BO9
								  </div>
								  <div class="item" data-value="11" data-text="BO11">
									BO11
								  </div>
								  <div class="item" data-value="13" data-text="BO13">
									BO13
								  </div>
								  <div class="item" data-value="15" data-text="BO15">
									BO15
								  </div>
								  <div class="item" data-value="17" data-text="BO17">
									BO17
								  </div>
								</div>
							  </div>
						  </div>
					</div>
					<div class="fields">
						<div class="field">
							<label>Warmups</label>
							<input type="number" name="warmups" id="warmups" data-value="0" placeholder="Warmups"/>
						  </div>
						<div class="field">
							<label>Score Reverse</label>
							<div class="ui selection dropdown">
								<input type="hidden" name="reverse">
								<i class="dropdown icon"></i>
								<div class="default text">Score Reverse</div>
								<div class="menu">
								  <div class="item" data-value="false" data-text="False">
									false
								  </div>
								  <div class="item" data-value="true" data-text="True">
									true
								  </div>
								</div>
							  </div>
						  </div>
					</div>
				
			  </div>
			  <div class="ui bottom attached tab segment" data-tab="settings">

				<div id="updatemessage1" name="updatemessage1" class="updatemessage">
					<div class="ui warning message">
						<div class="header">Old Version</div>
						<p>You're using an older version of the displayer, please be sure to update to the latest version to avoid bugs and malfunctions!
							You can update to the latest by:</p>
						<ul class="list">
						  <li>Closing the displayer and run <b>update.exe</b></li>
						  <li>Download the latest version <a href="https://github.com/AkinariHex/oTMD/releases/latest">here</a></li>
						</ul>
					</div>
				</div>

				<div class="fields">
					<div class="required field">
					  <label>APIkey</label>
					  <input type="text" name="apikey1" id="apikey1" placeholder="APIkey"/>
					</div>
					<div class="required field">
					  <label>UserID</label>
					  <input type="text" name="userid1" id="userid1" placeholder="UserID"/>
					</div>
				</div>
				<h4 class="ui dividing header"></h4>
				<div class="fields">
					<div class="required field">
						<label>Visualizer Style</label>
						<div class="ui selection dropdown">
							<input type="hidden" name="visualizerstyle">
							<i class="dropdown icon"></i>
							<div class="default text">Style</div>
							<div class="menu">
							  <div class="item" data-value="0px 0px 0px 0px" data-text="Default">
								Default
							  </div>
							  <div class="item" data-value="15px 15px 15px 15px" data-text="Rounded">
								Rounded
							  </div>
							  <div class="item" data-value="15px 15px 0px 0px" data-text="Top-Rounded">
								Top-Rounded
							  </div>
							  <div class="item" data-value="0px 0px 15px 15px" data-text="Bottom-Rounded">
								Bottom-Rounded
							  </div>
							</div>
						  </div>
					</div>
					<div class="field">
						<label>Width</label>
						<input placeholder="400" readonly="" type="text">
					</div>
					<div class="field">
						<label>Height</label>
						<input placeholder="130" readonly="" type="text">
					</div>
				</div>
			  </div>
			  <button class="ui submit button" name="save" id="save" type="submit">Save</button>
			  <button class="ui button" name="loadold" id="loadold" type="button">Load old settings</button>
			</div>
		</div>
	</body>

	<script>
		fetch('/version')
		.then((res) => res.json())
		.then((versiondata) => {
			const { oldVer, newVer } = versiondata

			console.log(oldVer < newVer)

			if(oldVer != newVer && oldVer < newVer){
				document.querySelector('#updatemessage').style.display = 'block';
				document.querySelector('.ui.form .warning.message').style.display = 'block';
				document.querySelector('#updatemessage1').style.display = 'block';
			} else {
				document.querySelector('#updatemessage').style.display = 'none';
				document.querySelector('.ui.form .warning.message').style.display = 'none';
				document.querySelector('#updatemessage1').style.display = 'none';
			}
		})

	</script>

	<script>
		$('.menu .item').tab();
		$('.ui.selection.dropdown').dropdown();
		$('.ui.equal.width.form').form('set values', {
			matchtype     	: 'teamvs',
			warmups 		: '0',
			reverse 		: 'false',
			visualizerstyle : '0px 0px 0px 0px'
		});
	</script>
	<script src="/socketio"></script>
	<script type="module">
		const socket = io()
		const loadConfig = async () => {
			let res = await fetch('/settings')
			res = await res.json()

			const { apikey, matchid, stage, warmups, bestof, matchtype, userid, reverse, visualizerstyle } = res

			if(res != null){
				$('.ui.equal.width.form').form('set values', {
					apikey: apikey,
					apikey1: apikey,
					userid: userid,
					userid1: userid,
					matchid: matchid,
					matchtype: matchtype,
					stage: stage,
					bestof: bestof,
					warmups: warmups,
					reverse: reverse,
					visualizerstyle: visualizerstyle
				});
			}

		}



		// save settings
		$('#save').click(e => {
			e.preventDefault();
			$('.ui.equal.width.form').form({
				fields: {
					apikey: 'empty',
					apikey1: 'empty',
					userid: 'empty',
					userid1: 'empty',
					matchid: 'empty',
					matchtype: 'empty',
					stage: 'empty',
					bestof: 'empty',
					warmups: 'empty',
					reverse: 'empty',
					visualizerstyle: 'empty'
				}
			});
			
			$('.ui.equal.width.form').form('submit');

			if($('.ui.equal.width.form').form('is valid') == true){	
				var $form = $('.ui.equal.width.form');
				var allFields = $form.form('get values');

				if(allFields.apikey == allFields.apikey1 && allFields.userid == allFields.userid1){
				const data = {
					apikey: allFields.apikey,
					matchid: allFields.matchid,
					stage: allFields.stage,
					warmups: allFields.warmups,
					bestof: allFields.bestof,
					matchtype: allFields.matchtype,
					userid: allFields.userid,
					reverse: allFields.reverse,
					visualizerstyle: allFields.visualizerstyle
				}

				socket.emit('save', data)

				let secondWindow = window.open('/visualizer')
				secondWindow.location.reload(true)
				}

			}

		})

		// load settings button
		$('#loadold').click(e => {
			e.preventDefault();
			loadConfig()
		})


		// same value for the two tabs
		$('#apikey').change(e => {
			let value = $('#apikey').val();
			$('#apikey1').val(value);
		})
		$('#userid').change(e => {
			let value = $('#userid').val();
			$('#userid1').val(value);
		})
		$('#apikey1').change(e => {
			let value = $('#apikey1').val();
			$('#apikey').val(value);
		})
		$('#userid1').change(e => {
			let value = $('#userid1').val();
			$('#userid').val(value);
		})

		//console.clear()
		loadConfig()
	</script>
</html>
